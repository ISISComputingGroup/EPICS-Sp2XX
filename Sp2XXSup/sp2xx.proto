# SP2XX protocol file.

# Manuel specifies out terminator as "CR LF" but this creates errors when communicating with the device.

OutTerminator = CR;
InTerminator = "";

return = CR LF;
Stopped = $return ":";
Infusion = $return ">";
Withdrawal = $return "<";
NA = $return "NA";

mismatch_catcher {
	in $return "E";
	out "error?";
	in $return "%(\$1)i" "%*{" $Stopped "|" $Infusion "|" $Withdrawal "}";
}

error_status {
	out "error?";
	in $return "%i%*{" $Stopped "|" $Infusion "|" $Withdrawal "}";
	@mismatch { mismatch_catcher; }
}

run {
    out "run";
	in "%(\$2){" $NA "|" $Infusion "|" $Withdrawal "}";
	@mismatch { mismatch_catcher; }
}

run_status {
	out "run?";
	in "%{" $Stopped "|" $Infusion "|" $Withdrawal "}";
	@mismatch { mismatch_catcher; }
}

stop {
	out "stop";
	in "%(\$2){" $NA "|" $Stopped "}";
	@mismatch { mismatch_catcher; }
}

get_mode {
	out "mode?";
	in "%{" $return "IW|" $return "WI|" $return "I|" $return "W|" $return "CON}%*{" $Stopped "|" $Infusion "|" $Withdrawal "}";
	@mismatch { mismatch_catcher; }
}

set_mode {	
	out "mode %{i\/w|w\/i|i|w|con}";
	in "%(\$2){" $return "NA|" $Stopped "}";
	@mismatch { mismatch_catcher; }
}

get_direction {
	out "dir?";
	in "%{" $return "I|" $return "W}%*{" $Stopped "|" $Infusion "|" $Withdrawal "}";
	@mismatch { mismatch_catcher; }
}

reverse_direction {
	out "dir rev";
	in "%(\$2){" $NA "|}%*{" $Stopped "|" $Infusion "|" $Withdrawal "}";
	@mismatch { mismatch_catcher; }
}