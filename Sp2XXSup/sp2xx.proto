# SP2XX protocol file.

# Manuel specifies out terminator as "CR LF" but this creates errors when communicating with the device.

OutTerminator = CR;
InTerminator = "";

return = CR LF;
stopped = $return,":";
infusing = $return,">";
withdrawing = $return,"<";

error_mismatch {
	in $return "E";
	out "error?";
	in $return "%(\$1)i";
}

error_status {
	out "error?";
	in $return "%{0|1|2|3|4|5|6|7}";
}

run {
    out "run";
	in "%{",$infusing,"|",$withdrawing,"}";
	@mismatch { error_mismatch; }
}

run_status {
	out "run?";
	in "%{",$stopped,"|",$infusing,"|",$withdrawing,"}";
	@mismatch { error_mismatch; }
}

stop {
	out "stop";
	in $stopped;
	@mismatch { error_mismatch; }
}

get_mode {
	out "mode?";
	in "%{I/W|W/I|I|W|CON}";
	@mismatch { error_mismatch; }
}